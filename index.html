<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<style>
			body {
				font: 10px sans-serif;
			}
			.axis path,
			.axis line {
			  fill: none;
			  stroke: #000;
			  shape-rendering: crispEdges;
			}
			.line, .sparkLine{
				fill: none;
				stroke: steelblue;
				stroke-weight:1.5px;
			}
			.metric {
				display: block;
				font-size: 16px;
			}
			.gr {
				text-align: center;
			}
			#submitButton {
				float: right;
			}
			.fields {
				width: 30px;
			}
			.ticker {
				margin: 10px;
				float: left;
			}
			.companyName {
				margin: 10px;
				float: right;
			}
		</style>
		<!--cssgrid-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="resources/cssgrid/css/1140.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="resources/cssgrid/css/styles.css" type="text/css" media="screen" />
		<script type="text/javascript" src="resources/cssgrid/js/css3-mediaqueries.js"></script>
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="finFunctions.js"></script>
		<script src="sparkLines.js"></script>
		<script src="scatterplot.js"></script>
	</head>
	<body>
		<div class="row">
				<h1 class="ticker">YELP</h1>
				<h2 class="companyName">Yelp Inc.</h2>
		</div>
		<div class="row">
			<div class="twelvecol last">
				<div id="chart"></div>
			</div>
		</div>
		<div class="row">
			<div class="sixcol">
				<h1 class="gr">User Opinion</h1>
			</div>
			<div class="sixcol last">
				<h1 class="gr">Growth Rates</h1>
			</div>
		</div>
		<div class="row">
			<div class="sixcol">
				<div id="histogram"></div>
			</div>
			<div class="threecol">
				<div class="metric">
					<form>
					Revenue: <input class="fields" id="revenue" type="float" value="0"/><br/>
					Historic:
					<svg id="sparkOne" width="265" height="100"></svg>
				</div>
				<div class="metric">
					Asset: <input class="fields" id="asset" type="float" value="0"/><br/>
					Historic:
					<svg id="sparkTwo" width="265" height="100"></svg>
				</div>
			</div>
			<div class="threecol last">
				<div class="metric">
					Capital Expenditures: <input class="fields" id="capex" type="float" value="0"/><br/>
					Historic:
					<svg id="sparkThree" width="265" height="100"></svg>
				</div>
				<div class="metric">
					Research & Development: <input class="fields" id="rnd" type="float" value="0"/><br/>
					Historic:
					<svg id="sparkFour" width="265" height="100"></svg>
				</div>
				<div class="metric">
					<input id="submitButton" type="submit" />
					</form>
					<p id="priceTargets"></p>
				</div>
			</div>
		</div>
		<!--d3 code-->
		<script src="getLineGraph.js"></script>
		<script src="sparkOne.js"></script>
		<script src="sparkTwo.js"></script>
		<script src="sparkThree.js"></script>
		<script src="sparkFour.js"></script>
		<!--on form submit-->
		<script type="text/javascript">
			$("form").submit(function() {
				var revenue = parseFloat(document.getElementById("revenue").value);
				var asset = parseFloat(document.getElementById("asset").value);
				var capex = parseFloat(document.getElementById("capex").value);
				var rnd = parseFloat(document.getElementById("rnd").value);
				
				d3.csv("data/yelpSharePrices.csv", function(error, data) {
					data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.close = +d.close;
					})

				  	var priceTargets = findPriceTargets(revenue, asset, capex, rnd);

				  	for (var i=0; i < priceTargets.length; i++) {
				  		priceTargets[i] = Math.round(priceTargets[i]);
				  		data[i].close = priceTargets[i];
				  	}

				  	document.getElementById('priceTargets').innerHTML = priceTargets.reverse();

					x.domain(d3.extent(data, function(d) { return d.date; }));
				  	y.domain(d3.extent(data, function(d) { return d.close; }));

					svg.selectAll("path")
						.data([data])
						.transition().duration(2000).delay(200)
						.attr("d", line);
				});
				d3.tsv("data/sparkOne.tsv", function(error, data) {
					data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.close = +d.close;
					})
					for (var i=8; i < data.length; i++) {
						data[i].close = data[i].close * (1 + revenue);
					}

					xSpark.domain(d3.extent(data, function(d) { return d.date; }));
				  	ySpark.domain(d3.extent(data, function(d) { return d.close; }));

					sparkOne.selectAll("path")
						.data([data])
						.transition().duration(2000).delay(200)
						.attr("d",sparkLine);
				});
				d3.tsv("data/sparkTwo.tsv", function(error, data) {
					data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.close = +d.close;
					})
					for (var i=8; i < data.length; i++) {
						data[i].close = data[i].close * (1 + asset);
					}

					xSparkTwo.domain(d3.extent(data, function(d) { return d.date; }));
				  	ySparkTwo.domain(d3.extent(data, function(d) { return d.close; }));

					sparkTwo.selectAll("path")
						.data([data])
						.transition().duration(2000).delay(200)
						.attr("d",sparkLineTwo);
				});
				d3.tsv("data/sparkThree.tsv", function(error, data) {
					data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.close = +d.close;
					})
					for (var i=8; i < data.length; i++) {
						data[i].close = data[i].close * (1 + capex);
					}

					xSparkThree.domain(d3.extent(data, function(d) { return d.date; }));
				  	ySparkThree.domain(d3.extent(data, function(d) { return d.close; }));

					sparkThree.selectAll("path")
						.data([data])
						.transition().duration(2000).delay(200)
						.attr("d",sparkLineThree);
				});
				d3.tsv("data/sparkFour.tsv", function(error, data) {
					data.forEach(function(d) {
						d.date = parseDate(d.date);
						d.close = +d.close;
					})
					for (var i=8; i < data.length; i++) {
						data[i].close = data[i].close * (1 + rnd);
					}

					xSparkFour.domain(d3.extent(data, function(d) { return d.date; }));
				  	ySparkFour.domain(d3.extent(data, function(d) { return d.close; }));

					sparkFour.selectAll("path")
						.data([data])
						.transition().duration(2000).delay(200)
						.attr("d",sparkLineFour);
				});
				return false;
			});
		</script>
		<script type="text/javascript">
			addScatterplot("histogram")
		</script>

	</body>
</html>